{"version":3,"sources":["/home/mouaadid/Desktop/why-render/dist/index.cjs","../src/hooks/useWhyRender.ts","../src/utils/diff.ts","../src/utils/env.ts","../src/hoc/withWhyRender.tsx","../src/index.ts"],"names":["name"],"mappings":"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","file":"/home/mouaadid/Desktop/why-render/dist/index.cjs","sourcesContent":[null,"import { useRef, useEffect } from 'react';\nimport { Options, Change } from '../types';\nimport { getChanges } from '../utils/diff';\nimport { shouldInstrument } from '../utils/env';\nimport { globalRenderTracker } from '../engine/RenderTracker';\nimport { globalPerformanceMonitor } from '../engine/PerformanceMonitor';\n\n// Generate stable component IDs\nlet componentIdCounter = 0;\nconst generateComponentId = (name: string): string => {\n    return `${name}-${++componentIdCounter}-${Date.now()}`;\n};\n\nexport function useWhyRender<TProps = any>(\n    props: TProps,\n    componentName?: string,\n    options?: Options\n): { lastProps: TProps | null; changes: Change[]; componentId: string } {\n    if (!shouldInstrument()) {\n        return { lastProps: null, changes: [], componentId: '' };\n    }\n\n    // Stable ID for this component instance\n    const componentIdRef = useRef<string>('');\n    if (!componentIdRef.current) {\n        const name = componentName || 'Component';\n        componentIdRef.current = generateComponentId(name);\n\n        // Register component in hierarchy\n        globalRenderTracker.registerComponent(name, componentIdRef.current);\n    }\n\n    const lastProps = useRef<TProps | null>(null);\n    const changesRef = useRef<Change[]>([]);\n    const renderCount = useRef(0);\n    const name = componentName || 'Component';\n    const strategy = options?.compareStrategy || 'shallow';\n\n    // Start performance tracking\n    globalPerformanceMonitor.markRenderStart(name, componentIdRef.current);\n\n    // Calculate changes during render\n    if (lastProps.current) {\n        changesRef.current = getChanges(\n            lastProps.current,\n            props,\n            strategy,\n            options?.customCompare,\n            options?.skipKeys\n        );\n\n        // Track render with changes\n        globalRenderTracker.trackRender(\n            name,\n            componentIdRef.current,\n            props,\n            changesRef.current\n        );\n\n        if (changesRef.current.length > 0) {\n            const msg = `[why-render] ${name} re-rendered because: ${changesRef.current.map(c => c.key).join(', ')}`;\n            console.warn(msg);\n\n            if (options?.verbose) {\n                console.groupCollapsed(`[why-render] ${name} details`);\n                changesRef.current.forEach(change => {\n                    // Truncate long values for display\n                    const formatVal = (v: any) => {\n                        try {\n                            const s = typeof v === 'string' ? v : JSON.stringify(v);\n                            return s && s.length > 1000 ? s.slice(0, 1000) + '...' : s;\n                        } catch { return String(v); }\n                    };\n\n                    console.log(`Prop '${change.key}':`, {\n                        ...change,\n                        oldValue: formatVal(change.oldValue),\n                        newValue: formatVal(change.newValue)\n                    });\n\n                    if (change.reason === 'function') {\n                        console.log('ðŸ’¡ Tip: Wrap with useCallback');\n                    } else if (change.reason === 'reference') {\n                        console.log('ðŸ’¡ Tip: Memoize object/array or move outside component');\n                    }\n                });\n                console.groupEnd();\n            }\n        }\n    } else {\n        // Initial render\n        globalRenderTracker.trackRender(\n            name,\n            componentIdRef.current,\n            props,\n            []\n        );\n    }\n\n    renderCount.current++;\n\n    // Commit phase: update lastProps and end performance tracking\n    useEffect(() => {\n        lastProps.current = props;\n        globalRenderTracker.commitRender(name, componentIdRef.current);\n    });\n\n    // Cleanup on unmount\n    useEffect(() => {\n        return () => {\n            globalRenderTracker.unregisterComponent(componentIdRef.current);\n        };\n    }, []);\n\n    return {\n        lastProps: lastProps.current,\n        changes: changesRef.current,\n        componentId: componentIdRef.current,\n    };\n}\n\n// Static track method for opt-in tracking\n(useWhyRender as any).track = () => {\n    return Symbol('why-render-token');\n};\n","import { Change, CompareStrategy } from '../types';\n\nfunction isObject(x: any): x is object {\n    return typeof x === 'object' && x !== null;\n}\n\nfunction fastDeepEqual(a: any, b: any, depth: number = 3): boolean {\n    if (depth < 0) return true; // Stop recursion, assume equal to avoid perf hit\n    if (Object.is(a, b)) return true;\n\n    if (!isObject(a) || !isObject(b)) return false;\n    if (Array.isArray(a) !== Array.isArray(b)) return false;\n\n    const keysA = Object.keys(a);\n    const keysB = Object.keys(b);\n\n    if (keysA.length !== keysB.length) return false;\n\n    for (const key of keysA) {\n        if (!Object.prototype.hasOwnProperty.call(b, key)) return false;\n        if (!fastDeepEqual((a as any)[key], (b as any)[key], depth - 1)) return false;\n    }\n\n    return true;\n}\n\nfunction deepEqual(a: any, b: any): boolean {\n    // Try structuredClone for deep copy comparison if available (modern browsers/Node)\n    // But structuredClone copies, it doesn't compare.\n    // We can use a recursive comparator that handles cycles if needed, \n    // or just JSON.stringify if we assume no cycles/functions for \"deep\" data.\n    // Requirement says: \"use user-provided structuredClone + JSON compare or a controlled recursive comparator\"\n    try {\n        return JSON.stringify(a) === JSON.stringify(b);\n    } catch (e) {\n        // Fallback to fastDeepEqual with higher depth if JSON fails (e.g. circular)\n        return fastDeepEqual(a, b, 10);\n    }\n}\n\nexport function getChanges(\n    prevProps: any,\n    nextProps: any,\n    strategy: CompareStrategy,\n    customCompare?: (a: any, b: any) => boolean,\n    skipKeys: string[] = []\n): Change[] {\n    const changes: Change[] = [];\n    const allKeys = new Set([...Object.keys(prevProps || {}), ...Object.keys(nextProps || {})]);\n\n    for (const key of allKeys) {\n        if (skipKeys.includes(key)) continue;\n\n        const prev = prevProps ? prevProps[key] : undefined;\n        const next = nextProps ? nextProps[key] : undefined;\n\n        if (Object.is(prev, next)) {\n            continue;\n        }\n\n        if (customCompare && customCompare(prev, next)) {\n            continue;\n        }\n\n        let reason: Change['reason'] = 'value';\n        let areDeepEqual = false;\n\n        if (typeof prev !== typeof next) {\n            reason = 'type';\n        } else if (typeof prev === 'function') {\n            reason = 'function';\n        } else if (Array.isArray(prev) && Array.isArray(next) && prev.length !== next.length) {\n            reason = 'length';\n        } else if (isObject(prev) && isObject(next)) {\n            // It's an object/array reference change\n            if (strategy === 'deep') {\n                areDeepEqual = deepEqual(prev, next);\n            } else if (strategy === 'fast-deep') {\n                areDeepEqual = fastDeepEqual(prev, next);\n            } else {\n                // shallow strategy: we already know they are not Object.is, so they are different refs\n                areDeepEqual = false;\n            }\n\n            if (areDeepEqual) {\n                reason = 'reference';\n            } else {\n                reason = 'value'; // Deeply different\n            }\n        }\n\n        changes.push({\n            key,\n            reason,\n            oldValue: prev,\n            newValue: next,\n        });\n    }\n\n    return changes;\n}\n","export function shouldInstrument(): boolean {\n    // Check Vite environment variable (import.meta.env)\n    if (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env.DEV) {\n        return true;\n    }\n    // Check Node.js environment variable (process.env)\n    if (typeof process !== 'undefined' && process.env.NODE_ENV !== 'production') {\n        return true;\n    }\n    // Check manual override flag\n    if (typeof window !== 'undefined' && (window as any).__WHY_RENDER__ === true) {\n        return true;\n    }\n    return false;\n}\n","import React, { forwardRef } from 'react';\nimport { Options } from '../types';\nimport { useWhyRender } from '../hooks/useWhyRender';\n\nexport function withWhyRender<TProps extends object>(\n    Component: React.ComponentType<TProps>,\n    options?: Options\n): React.FC<TProps> {\n    const WrappedComponent = forwardRef<any, TProps>((props, ref) => {\n        const componentName = Component.displayName || Component.name || 'Component';\n        useWhyRender(props, componentName, options);\n\n        return <Component {...props as any} ref={ref} />;\n    });\n\n    WrappedComponent.displayName = `withWhyRender(${Component.displayName || Component.name || 'Component'})`;\n    return WrappedComponent as unknown as React.FC<TProps>;\n}\n","import { useWhyRender } from './hooks/useWhyRender';\nimport { withWhyRender } from './hoc/withWhyRender';\nimport { Options, CompareStrategy, Change } from './types';\n\n// Augment the function type to include track\nexport type UseWhyRender = typeof useWhyRender & { track: () => symbol };\n\nconst useWhyRenderExport = useWhyRender as UseWhyRender;\n\nexport { useWhyRenderExport as useWhyRender };\nexport { withWhyRender };\nexport type { Options, CompareStrategy, Change };\n"]}