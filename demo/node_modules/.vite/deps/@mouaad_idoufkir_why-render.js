import {
  globalPerformanceMonitor,
  globalRenderTracker
} from "./chunk-6Y7OK2AE.js";
import {
  require_jsx_runtime
} from "./chunk-OBNO665P.js";
import {
  __toESM,
  require_react
} from "./chunk-AQI5YXZE.js";

// node_modules/@mouaad_idoufkir/why-render/dist/index.js
var import_react = __toESM(require_react());
var import_react2 = __toESM(require_react());
var import_jsx_runtime = __toESM(require_jsx_runtime());
function isObject(x) {
  return typeof x === "object" && x !== null;
}
function fastDeepEqual(a, b, depth = 3) {
  if (depth < 0) return true;
  if (Object.is(a, b)) return true;
  if (!isObject(a) || !isObject(b)) return false;
  if (Array.isArray(a) !== Array.isArray(b)) return false;
  const keysA = Object.keys(a);
  const keysB = Object.keys(b);
  if (keysA.length !== keysB.length) return false;
  for (const key of keysA) {
    if (!Object.prototype.hasOwnProperty.call(b, key)) return false;
    if (!fastDeepEqual(a[key], b[key], depth - 1)) return false;
  }
  return true;
}
function deepEqual(a, b) {
  try {
    return JSON.stringify(a) === JSON.stringify(b);
  } catch (e) {
    return fastDeepEqual(a, b, 10);
  }
}
function getChanges(prevProps, nextProps, strategy, customCompare, skipKeys = []) {
  const changes = [];
  const allKeys = /* @__PURE__ */ new Set([...Object.keys(prevProps || {}), ...Object.keys(nextProps || {})]);
  for (const key of allKeys) {
    if (skipKeys.includes(key)) continue;
    const prev = prevProps ? prevProps[key] : void 0;
    const next = nextProps ? nextProps[key] : void 0;
    if (Object.is(prev, next)) {
      continue;
    }
    if (customCompare && customCompare(prev, next)) {
      continue;
    }
    let reason = "value";
    let areDeepEqual = false;
    if (typeof prev !== typeof next) {
      reason = "type";
    } else if (typeof prev === "function") {
      reason = "function";
    } else if (Array.isArray(prev) && Array.isArray(next) && prev.length !== next.length) {
      reason = "length";
    } else if (isObject(prev) && isObject(next)) {
      if (strategy === "deep") {
        areDeepEqual = deepEqual(prev, next);
      } else if (strategy === "fast-deep") {
        areDeepEqual = fastDeepEqual(prev, next);
      } else {
        areDeepEqual = false;
      }
      if (areDeepEqual) {
        reason = "reference";
      } else {
        reason = "value";
      }
    }
    changes.push({
      key,
      reason,
      oldValue: prev,
      newValue: next
    });
  }
  return changes;
}
function shouldInstrument() {
  if (typeof import.meta !== "undefined" && import.meta.env && import.meta.env.DEV) {
    return true;
  }
  if (typeof process !== "undefined" && true) {
    return true;
  }
  if (typeof window !== "undefined" && window.__WHY_RENDER__ === true) {
    return true;
  }
  return false;
}
var componentIdCounter = 0;
var generateComponentId = (name) => {
  return `${name}-${++componentIdCounter}-${Date.now()}`;
};
function useWhyRender(props, componentName, options) {
  if (!shouldInstrument()) {
    return { lastProps: null, changes: [], componentId: "" };
  }
  const componentIdRef = (0, import_react.useRef)("");
  if (!componentIdRef.current) {
    const name2 = componentName || "Component";
    componentIdRef.current = generateComponentId(name2);
    globalRenderTracker.registerComponent(name2, componentIdRef.current);
  }
  const lastProps = (0, import_react.useRef)(null);
  const changesRef = (0, import_react.useRef)([]);
  const renderCount = (0, import_react.useRef)(0);
  const name = componentName || "Component";
  const strategy = (options == null ? void 0 : options.compareStrategy) || "shallow";
  globalPerformanceMonitor.markRenderStart(name, componentIdRef.current);
  if (lastProps.current) {
    changesRef.current = getChanges(
      lastProps.current,
      props,
      strategy,
      options == null ? void 0 : options.customCompare,
      options == null ? void 0 : options.skipKeys
    );
    globalRenderTracker.trackRender(
      name,
      componentIdRef.current,
      props,
      changesRef.current
    );
    if (changesRef.current.length > 0) {
      const msg = `[why-render] ${name} re-rendered because: ${changesRef.current.map((c) => c.key).join(", ")}`;
      console.warn(msg);
      if (options == null ? void 0 : options.verbose) {
        console.groupCollapsed(`[why-render] ${name} details`);
        changesRef.current.forEach((change) => {
          const formatVal = (v) => {
            try {
              const s = typeof v === "string" ? v : JSON.stringify(v);
              return s && s.length > 1e3 ? s.slice(0, 1e3) + "..." : s;
            } catch {
              return String(v);
            }
          };
          console.log(`Prop '${change.key}':`, {
            ...change,
            oldValue: formatVal(change.oldValue),
            newValue: formatVal(change.newValue)
          });
          if (change.reason === "function") {
            console.log("ðŸ’¡ Tip: Wrap with useCallback");
          } else if (change.reason === "reference") {
            console.log("ðŸ’¡ Tip: Memoize object/array or move outside component");
          }
        });
        console.groupEnd();
      }
    }
  } else {
    globalRenderTracker.trackRender(
      name,
      componentIdRef.current,
      props,
      []
    );
  }
  renderCount.current++;
  (0, import_react.useEffect)(() => {
    lastProps.current = props;
    globalRenderTracker.commitRender(name, componentIdRef.current);
  });
  (0, import_react.useEffect)(() => {
    return () => {
      globalRenderTracker.unregisterComponent(componentIdRef.current);
    };
  }, []);
  return {
    lastProps: lastProps.current,
    changes: changesRef.current,
    componentId: componentIdRef.current
  };
}
useWhyRender.track = () => {
  return Symbol("why-render-token");
};
function withWhyRender(Component, options) {
  const WrappedComponent = (0, import_react2.forwardRef)((props, ref) => {
    const componentName = Component.displayName || Component.name || "Component";
    useWhyRender(props, componentName, options);
    return (0, import_jsx_runtime.jsx)(Component, { ...props, ref });
  });
  WrappedComponent.displayName = `withWhyRender(${Component.displayName || Component.name || "Component"})`;
  return WrappedComponent;
}
var useWhyRenderExport = useWhyRender;
export {
  useWhyRenderExport as useWhyRender,
  withWhyRender
};
//# sourceMappingURL=@mouaad_idoufkir_why-render.js.map
