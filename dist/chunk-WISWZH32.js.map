{"version":3,"sources":["../src/engine/EventEmitter.ts"],"sourcesContent":["/**\n * Simple type-safe event emitter for render tracking events\n */\n\nimport type { RenderEvent } from '../types';\n\nexport type RenderEventType =\n    | 'render:start'\n    | 'render:end'\n    | 'change:detected'\n    | 'performance:warning'\n    | 'component:mounted'\n    | 'component:unmounted';\n\nexport interface RenderEventPayload {\n    'render:start': {\n        componentName: string;\n        componentId: string;\n        timestamp: number;\n    };\n    'render:end': {\n        componentName: string;\n        componentId: string;\n        renderEvent: RenderEvent;\n    };\n    'change:detected': {\n        componentName: string;\n        componentId: string;\n        changes: Array<{\n            key: string;\n            reason: string;\n            oldValue: any;\n            newValue: any;\n        }>;\n    };\n    'performance:warning': {\n        componentName: string;\n        componentId: string;\n        duration: number;\n        threshold: number;\n    };\n    'component:mounted': {\n        componentName: string;\n        componentId: string;\n    };\n    'component:unmounted': {\n        componentName: string;\n        componentId: string;\n    };\n}\n\ntype EventHandler<T extends RenderEventType> = (payload: RenderEventPayload[T]) => void;\n\nexport class EventEmitter {\n    private listeners: Map<RenderEventType, Set<EventHandler<any>>> = new Map();\n\n    /**\n     * Subscribe to an event\n     */\n    on<T extends RenderEventType>(event: T, handler: EventHandler<T>): () => void {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, new Set());\n        }\n\n        this.listeners.get(event)!.add(handler);\n\n        // Return unsubscribe function\n        return () => this.off(event, handler);\n    }\n\n    /**\n     * Unsubscribe from an event\n     */\n    off<T extends RenderEventType>(event: T, handler: EventHandler<T>): void {\n        const handlers = this.listeners.get(event);\n        if (handlers) {\n            handlers.delete(handler);\n        }\n    }\n\n    /**\n     * Emit an event to all subscribers\n     */\n    emit<T extends RenderEventType>(event: T, payload: RenderEventPayload[T]): void {\n        const handlers = this.listeners.get(event);\n        if (handlers) {\n            handlers.forEach(handler => {\n                try {\n                    handler(payload);\n                } catch (error) {\n                    console.error(`[why-render] Error in event handler for ${event}:`, error);\n                }\n            });\n        }\n    }\n\n    /**\n     * Subscribe to an event once (auto-unsubscribe after first call)\n     */\n    once<T extends RenderEventType>(event: T, handler: EventHandler<T>): () => void {\n        const wrappedHandler = (payload: RenderEventPayload[T]) => {\n            handler(payload);\n            this.off(event, wrappedHandler);\n        };\n\n        return this.on(event, wrappedHandler as EventHandler<T>);\n    }\n\n    /**\n     * Remove all listeners for a specific event or all events\n     */\n    clear(event?: RenderEventType): void {\n        if (event) {\n            this.listeners.delete(event);\n        } else {\n            this.listeners.clear();\n        }\n    }\n\n    /**\n     * Get listener count for an event\n     */\n    listenerCount(event: RenderEventType): number {\n        return this.listeners.get(event)?.size ?? 0;\n    }\n}\n\n// Global singleton instance\nexport const globalEventEmitter = new EventEmitter();\n"],"mappings":";;;;;AAqDO,IAAM,eAAN,MAAmB;AAAA,EAAnB;AACH,wBAAQ,aAA0D,oBAAI,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,EAK1E,GAA8B,OAAU,SAAsC;AAC1E,QAAI,CAAC,KAAK,UAAU,IAAI,KAAK,GAAG;AAC5B,WAAK,UAAU,IAAI,OAAO,oBAAI,IAAI,CAAC;AAAA,IACvC;AAEA,SAAK,UAAU,IAAI,KAAK,EAAG,IAAI,OAAO;AAGtC,WAAO,MAAM,KAAK,IAAI,OAAO,OAAO;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKA,IAA+B,OAAU,SAAgC;AACrE,UAAM,WAAW,KAAK,UAAU,IAAI,KAAK;AACzC,QAAI,UAAU;AACV,eAAS,OAAO,OAAO;AAAA,IAC3B;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,KAAgC,OAAU,SAAsC;AAC5E,UAAM,WAAW,KAAK,UAAU,IAAI,KAAK;AACzC,QAAI,UAAU;AACV,eAAS,QAAQ,aAAW;AACxB,YAAI;AACA,kBAAQ,OAAO;AAAA,QACnB,SAAS,OAAO;AACZ,kBAAQ,MAAM,2CAA2C,KAAK,KAAK,KAAK;AAAA,QAC5E;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,KAAgC,OAAU,SAAsC;AAC5E,UAAM,iBAAiB,CAAC,YAAmC;AACvD,cAAQ,OAAO;AACf,WAAK,IAAI,OAAO,cAAc;AAAA,IAClC;AAEA,WAAO,KAAK,GAAG,OAAO,cAAiC;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAA+B;AACjC,QAAI,OAAO;AACP,WAAK,UAAU,OAAO,KAAK;AAAA,IAC/B,OAAO;AACH,WAAK,UAAU,MAAM;AAAA,IACzB;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,OAAgC;AAC1C,WAAO,KAAK,UAAU,IAAI,KAAK,GAAG,QAAQ;AAAA,EAC9C;AACJ;AAGO,IAAM,qBAAqB,IAAI,aAAa;","names":[]}