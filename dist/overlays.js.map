{"version":3,"sources":["../src/overlays/UpdateFlash.tsx","../src/engine/EventEmitter.ts","../src/store/index.ts"],"sourcesContent":["/**\n * Flash Update Overlay\n * Highlights components when they update (like React DevTools)\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { globalEventEmitter } from '../engine/EventEmitter';\nimport { useDevToolsStore } from '../store';\n\nexport const UpdateFlash: React.FC = () => {\n    const { showFlash } = useDevToolsStore();\n    const [flashes, setFlashes] = useState<Map<string, number>>(new Map());\n\n    useEffect(() => {\n        if (!showFlash) return;\n\n        const handleRenderEnd = (payload: { componentId: string }) => {\n            setFlashes((prev) => {\n                const next = new Map(prev);\n                next.set(payload.componentId, Date.now());\n                return next;\n            });\n\n            // Remove flash after animation\n            setTimeout(() => {\n                setFlashes((prev) => {\n                    const next = new Map(prev);\n                    next.delete(payload.componentId);\n                    return next;\n                });\n            }, 500);\n        };\n\n        const unsubscribe = globalEventEmitter.on('render:end', handleRenderEnd);\n        return () => unsubscribe();\n    }, [showFlash]);\n\n    if (!showFlash || flashes.size === 0) return null;\n\n    return (\n        <div className=\"fixed inset-0 pointer-events-none z-[9997]\">\n            {Array.from(flashes.keys()).map((componentId) => (\n                <div\n                    key={componentId}\n                    className=\"absolute inset-0 border-4 border-blue-500 animate-flash\"\n                    style={{\n                        animation: 'flash 0.5s ease-in-out',\n                    }}\n                />\n            ))}\n        </div>\n    );\n};\n","/**\n * Simple type-safe event emitter for render tracking events\n */\n\nexport type RenderEventType =\n    | 'render:start'\n    | 'render:end'\n    | 'change:detected'\n    | 'performance:warning'\n    | 'component:mounted'\n    | 'component:unmounted';\n\nexport interface RenderEventPayload {\n    'render:start': {\n        componentName: string;\n        componentId: string;\n        timestamp: number;\n    };\n    'render:end': {\n        componentName: string;\n        componentId: string;\n        timestamp: number;\n        duration: number;\n    };\n    'change:detected': {\n        componentName: string;\n        componentId: string;\n        changes: Array<{\n            key: string;\n            reason: string;\n            oldValue: any;\n            newValue: any;\n        }>;\n    };\n    'performance:warning': {\n        componentName: string;\n        componentId: string;\n        duration: number;\n        threshold: number;\n    };\n    'component:mounted': {\n        componentName: string;\n        componentId: string;\n    };\n    'component:unmounted': {\n        componentName: string;\n        componentId: string;\n    };\n}\n\ntype EventHandler<T extends RenderEventType> = (payload: RenderEventPayload[T]) => void;\n\nexport class EventEmitter {\n    private listeners: Map<RenderEventType, Set<EventHandler<any>>> = new Map();\n\n    /**\n     * Subscribe to an event\n     */\n    on<T extends RenderEventType>(event: T, handler: EventHandler<T>): () => void {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, new Set());\n        }\n\n        this.listeners.get(event)!.add(handler);\n\n        // Return unsubscribe function\n        return () => this.off(event, handler);\n    }\n\n    /**\n     * Unsubscribe from an event\n     */\n    off<T extends RenderEventType>(event: T, handler: EventHandler<T>): void {\n        const handlers = this.listeners.get(event);\n        if (handlers) {\n            handlers.delete(handler);\n        }\n    }\n\n    /**\n     * Emit an event to all subscribers\n     */\n    emit<T extends RenderEventType>(event: T, payload: RenderEventPayload[T]): void {\n        const handlers = this.listeners.get(event);\n        if (handlers) {\n            handlers.forEach(handler => {\n                try {\n                    handler(payload);\n                } catch (error) {\n                    console.error(`[why-render] Error in event handler for ${event}:`, error);\n                }\n            });\n        }\n    }\n\n    /**\n     * Subscribe to an event once (auto-unsubscribe after first call)\n     */\n    once<T extends RenderEventType>(event: T, handler: EventHandler<T>): () => void {\n        const wrappedHandler = (payload: RenderEventPayload[T]) => {\n            handler(payload);\n            this.off(event, wrappedHandler);\n        };\n\n        return this.on(event, wrappedHandler as EventHandler<T>);\n    }\n\n    /**\n     * Remove all listeners for a specific event or all events\n     */\n    clear(event?: RenderEventType): void {\n        if (event) {\n            this.listeners.delete(event);\n        } else {\n            this.listeners.clear();\n        }\n    }\n\n    /**\n     * Get listener count for an event\n     */\n    listenerCount(event: RenderEventType): number {\n        return this.listeners.get(event)?.size ?? 0;\n    }\n}\n\n// Global singleton instance\nexport const globalEventEmitter = new EventEmitter();\n","/**\n * Zustand store for DevTools UI state\n */\n\nimport { create } from 'zustand';\nimport type { RenderEvent, ComponentHierarchyNode } from '../engine/RenderTracker';\nimport type { PerformanceMetrics } from '../engine/PerformanceMonitor';\n\nexport interface DevToolsState {\n    // UI State\n    isOpen: boolean;\n    activePanel: 'timeline' | 'flamegraph' | 'tree' | 'stats' | 'diff' | null;\n    selectedComponentId: string | null;\n\n    // Overlays\n    showHeatmap: boolean;\n    showFlash: boolean;\n    showGrid: boolean;\n\n    // Data\n    renders: RenderEvent[];\n    hierarchy: ComponentHierarchyNode[];\n    metrics: PerformanceMetrics[];\n\n    // Filters\n    searchQuery: string;\n    minDuration: number;\n    maxRenders: number;\n\n    // Settings\n    slowThreshold: number;\n    maxHistorySize: number;\n    autoScroll: boolean;\n\n    // Actions\n    toggleOpen: () => void;\n    setActivePanel: (panel: DevToolsState['activePanel']) => void;\n    setSelectedComponent: (componentId: string | null) => void;\n    toggleHeatmap: () => void;\n    toggleFlash: () => void;\n    toggleGrid: () => void;\n    updateRenders: (renders: RenderEvent[]) => void;\n    updateHierarchy: (hierarchy: ComponentHierarchyNode[]) => void;\n    updateMetrics: (metrics: PerformanceMetrics[]) => void;\n    setSearchQuery: (query: string) => void;\n    setMinDuration: (ms: number) => void;\n    setMaxRenders: (count: number) => void;\n    setSlowThreshold: (ms: number) => void;\n    clearData: () => void;\n}\n\nexport const useDevToolsStore = create<DevToolsState>((set) => ({\n    // Initial state\n    isOpen: false,\n    activePanel: null,\n    selectedComponentId: null,\n\n    showHeatmap: false,\n    showFlash: true,\n    showGrid: false,\n\n    renders: [],\n    hierarchy: [],\n    metrics: [],\n\n    searchQuery: '',\n    minDuration: 0,\n    maxRenders: 1000,\n\n    slowThreshold: 16,\n    maxHistorySize: 1000,\n    autoScroll: true,\n\n    // Actions\n    toggleOpen: () => set((state) => ({ isOpen: !state.isOpen })),\n\n    setActivePanel: (panel) => set({ activePanel: panel }),\n\n    setSelectedComponent: (componentId) => set({ selectedComponentId: componentId }),\n\n    toggleHeatmap: () => set((state) => ({ showHeatmap: !state.showHeatmap })),\n\n    toggleFlash: () => set((state) => ({ showFlash: !state.showFlash })),\n\n    toggleGrid: () => set((state) => ({ showGrid: !state.showGrid })),\n\n    updateRenders: (renders) => set({ renders }),\n\n    updateHierarchy: (hierarchy) => set({ hierarchy }),\n\n    updateMetrics: (metrics) => set({ metrics }),\n\n    setSearchQuery: (query) => set({ searchQuery: query }),\n\n    setMinDuration: (ms) => set({ minDuration: ms }),\n\n    setMaxRenders: (count) => set({ maxRenders: count }),\n\n    setSlowThreshold: (ms) => set({ slowThreshold: ms }),\n\n    clearData: () => set({\n        renders: [],\n        hierarchy: [],\n        metrics: [],\n        selectedComponentId: null,\n    }),\n}));\n"],"mappings":"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","names":[]}